import{Q as $,u as B,_ as O,a as V,p as R,b as q,c as I,d as T}from"./TextInput-C0JS5N8M.js";import{i as L,h as j,f as C,_ as D,c as w,o as y,a as x,r as H,g as K,j as n,k as z,t as U,l as M,m as a,n as A,d as S}from"./index-CCcJeI5s.js";import"./PrimaryButton.vue_vue_type_script_setup_true_lang-1fd3ZNkv.js";var G=class extends ${constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:L()})}getOptimisticResult(e){return e.behavior=L(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){var u,r;const{state:s}=e,i=super.createResult(e,t),{isFetching:d,isRefetching:m,isError:g,isRefetchError:p}=i,c=(r=(u=s.fetchMeta)==null?void 0:u.fetchMore)==null?void 0:r.direction,l=g&&c==="forward",f=d&&c==="forward",P=g&&c==="backward",v=d&&c==="backward";return{...i,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:C(t,s.data),hasPreviousPage:j(t,s.data),isFetchNextPageError:l,isFetchingNextPage:f,isFetchPreviousPageError:P,isFetchingPreviousPage:v,isRefetchError:p&&!l&&!P,isRefetching:m&&!f&&!v}}};function J(e,t){return B(G,e)}const W={name:"ScreenLoader"},X={class:"w-full h-screen flex justify-center items-center z-10"};function Y(e,t,s,i,d,m){return y(),w("article",X,t[0]||(t[0]=[x("img",{src:O,alt:"Loading...",class:"pokeball-animation"},null,-1)]))}const Z=D(W,[["render",Y],["__scopeId","data-v-8ba64d97"]]);function ee(e,t=10){const s=H("");let i=null;K(e,o=>{if(i&&clearTimeout(i),!o||!o.trim()){s.value="";return}i=setTimeout(()=>{s.value=o.trim()},300)},{immediate:!0});const{data:d,fetchNextPage:m,hasNextPage:g,isFetchingNextPage:p,isLoading:c,error:l}=J({queryKey:["pokemon-paginated"],queryFn:({pageParam:o})=>R.getPokemonPaginated(o??1,t),getNextPageParam:(o,N)=>o.hasMore?N.length+1:void 0,initialPageParam:1,staleTime:10*60*1e3,retry:2}),f=n(()=>s.value.length>0),{data:P,isLoading:v,error:_}=V({queryKey:n(()=>["pokemon-search",s.value]),queryFn:()=>R.searchPokemon(s.value,10),enabled:f,staleTime:5*60*1e3,retry:2}),u=n(()=>{var o;return((o=d.value)==null?void 0:o.pages.flatMap(N=>N.pokemon))||[]}),r=n(()=>s.value.length>0),b=n(()=>r.value?P.value||[]:u.value||[]),h=n(()=>r.value?v.value:!1),k=n(()=>r.value?_.value:l.value),E=n(()=>r.value&&b.value.length===0&&!h.value),F=n(()=>c.value&&u.value.length===0),Q=n(()=>l.value&&u.value.length===0?l.value:null);return{displayedPokemon:b,paginatedPokemon:u,isInitialLoading:F,isLoading:h,isPaginationLoading:c,initialLoadError:Q,error:k,hasSearched:r,showNoResults:E,hasNextPage:g,isFetchingNextPage:p,loadMore:async()=>{g.value&&!p.value&&await m()}}}const te={key:1,class:"max-w-4xl mx-auto p-4 min-h-screen flex flex-col justify-center items-center bg-poke-light-gray-100"},ae={key:2,class:"mx-auto h-screen flex flex-col"},se={class:"w-full max-w-4xl mx-auto flex-shrink-0 p-4"},re={class:"w-full max-w-4xl mx-auto flex-1 mb-4 min-h-0 px-3"},le={__name:"HomePage",setup(e){const t=z(),s=U(t,"searchQuery"),{displayedPokemon:i,isInitialLoading:d,isLoading:m,isPaginationLoading:g,initialLoadError:p,error:c,hasSearched:l,showNoResults:f,hasNextPage:P,isFetchingNextPage:v,loadMore:_}=ee(s,10),u=()=>{l.value||_()},r=()=>{window.location.reload()};return(b,h)=>a(d)?(y(),M(Z,{key:0})):a(p)?(y(),w("div",te,[x("div",{class:"text-center py-10 text-red-500"},[h[2]||(h[2]=x("p",null,"Failed to load Pokemon data. Please refresh the page.",-1)),x("button",{onClick:r,class:"mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"}," Refresh Page ")])])):(y(),w("section",ae,[x("div",se,[S(q,{modelValue:a(t).searchQuery,"onUpdate:modelValue":h[0]||(h[0]=k=>a(t).searchQuery=k),placeholder:"Search Pokemon..."},null,8,["modelValue"])]),x("div",re,[S(I,{"displayed-pokemon":a(i),"is-loading":a(m)||a(g),error:a(c),"show-no-results":a(f),"has-searched":a(l),"has-next-page":a(P),"is-fetching-next-page":a(v),onLoadMore:u,onResetSearch:h[1]||(h[1]=k=>a(t).clearSearch())},null,8,["displayed-pokemon","is-loading","error","show-no-results","has-searched","has-next-page","is-fetching-next-page"])]),a(f)?A("",!0):(y(),M(T,{key:0}))]))}};export{le as default};
